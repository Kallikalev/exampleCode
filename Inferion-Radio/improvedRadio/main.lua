require "/scripts/vec2.lua"
require "/scripts/rect.lua"
require "/improvedRadio/Color.lua"
require "/improvedRadio/Base64.lua"

--[[

frames i need to include:
	happy: happy.2
	neutral: neutral.2
	laugh: laugh.1
	sad: sad.2
	angry: annoyed.2
	shout: shout.1
	surprised: oooh.2
	none: blink.1

]]

function init()
	baseDirectiveGrid = "?crop;0;0;1;1?setcolor=fff?replace;fff0=fff?border=1;fff;000?scale=1.15;1.12?crop;1;1;3;3?replace;fbfbfb=000;eaeaea=380000;e4e4e4=00003a;6a6a6a=38003a?multiply=fff0?scale=55.5;57.5?crop=0;0;56;58?replace;0a000a00=002f00;0a000b00=002e00;0a000c00=002d00;0a000d00=002c00;0a000e00=002b00;0a000f00=002a00;0a001000=002900;0a001100=002800;0a001200=002700;0a001300=002600;0a001400=002500;0a001500=002400;0a001600=002300;0a001700=020;0a001800=002100;0a001900=002000;0a001a00=001f00;0a001b00=001e00;0a001c00=001d00;0a001d00=001c00;0a001e00=001b00;0a001f00=001a00;0a002000=001900;0a002100=001800;0a002200=001700;0a002300=001600;0a002400=001500;0a002500=001400;0a002600=001300;0a002700=001200;0a002800=010;0a002900=001000;0a002a00=000f00;0a002b00=000e00;0a002c00=000d00;0a002d00=000c00;0a002e00=000b00;0a002f00=000a00;0a003000=000900;0a003100=000800;0a003200=000700;0a003300=000600;0a003400=000500;0a003500=000400;0a003600=000300;0a003700=000200;0a003800=000100;0a003900=000;0b000a00=012f00;0b000b00=012e00;0b000c00=012d00;0b000d00=012c00;0b000e00=012b00;0b000f00=012a00;0b001000=012900;0b001100=012800;0b001200=012700;0b001300=012600;0b001400=012500;0b001500=012400;0b001600=012300;0b001700=012200;0b001800=012100;0b001900=012000;0b001a00=011f00;0b001b00=011e00;0b001c00=011d00;0b001d00=011c00;0b001e00=011b00;0b001f00=011a00;0b002000=011900;0b002100=011800;0b002200=011700;0b002300=011600;0b002400=011500;0b002500=011400;0b002600=011300;0b002700=011200;0b002800=011100;0b002900=011000;0b002a00=010f00;0b002b00=010e00;0b002c00=010d00;0b002d00=010c00;0b002e00=010b00;0b002f00=010a00;0b003000=010900;0b003100=010800;0b003200=010700;0b003300=010600;0b003400=010500;0b003500=010400;0b003600=010300;0b003700=010200;0b003800=010100;0b003900=010000;0c000a00=022f00;0c000b00=022e00;0c000c00=022d00;0c000d00=022c00;0c000e00=022b00;0c000f00=022a00;0c001000=022900;0c001100=022800;0c001200=022700;0c001300=022600;0c001400=022500;0c001500=022400;0c001600=022300;0c001700=022200;0c001800=022100;0c001900=022000;0c001a00=021f00;0c001b00=021e00;0c001c00=021d00;0c001d00=021c00;0c001e00=021b00;0c001f00=021a00;0c002000=021900;0c002100=021800;0c002200=021700;0c002300=021600;0c002400=021500;0c002500=021400;0c002600=021300;0c002700=021200;0c002800=021100;0c002900=021000;0c002a00=020f00;0c002b00=020e00;0c002c00=020d00;0c002d00=020c00;0c002e00=020b00;0c002f00=020a00;0c003000=020900;0c003100=020800;0c003200=020700;0c003300=020600;0c003400=020500;0c003500=020400;0c003600=020300;0c003700=020200;0c003800=020100;0c003900=020000;0d000a00=032f00;0d000b00=032e00;0d000c00=032d00;0d000d00=032c00;0d000e00=032b00;0d000f00=032a00;0d001000=032900;0d001100=032800;0d001200=032700;0d001300=032600;0d001400=032500;0d001500=032400;0d001600=032300;0d001700=032200;0d001800=032100;0d001900=032000;0d001a00=031f00;0d001b00=031e00;0d001c00=031d00;0d001d00=031c00;0d001e00=031b00;0d001f00=031a00;0d002000=031900;0d002100=031800;0d002200=031700;0d002300=031600;0d002400=031500;0d002500=031400;0d002600=031300;0d002700=031200;0d002800=031100;0d002900=031000;0d002a00=030f00;0d002b00=030e00;0d002c00=030d00;0d002d00=030c00;0d002e00=030b00;0d002f00=030a00;0d003000=030900;0d003100=030800;0d003200=030700;0d003300=030600;0d003400=030500;0d003500=030400;0d003600=030300;0d003700=030200;0d003800=030100;0d003900=030000;0e000a00=042f00;0e000b00=042e00;0e000c00=042d00;0e000d00=042c00;0e000e00=042b00;0e000f00=042a00;0e001000=042900;0e001100=042800;0e001200=042700;0e001300=042600;0e001400=042500;0e001500=042400;0e001600=042300;0e001700=042200;0e001800=042100;0e001900=042000;0e001a00=041f00;0e001b00=041e00;0e001c00=041d00;0e001d00=041c00;0e001e00=041b00;0e001f00=041a00;0e002000=041900;0e002100=041800;0e002200=041700;0e002300=041600;0e002400=041500;0e002500=041400;0e002600=041300;0e002700=041200;0e002800=041100;0e002900=041000;0e002a00=040f00;0e002b00=040e00;0e002c00=040d00;0e002d00=040c00;0e002e00=040b00;0e002f00=040a00;0e003000=040900;0e003100=040800;0e003200=040700;0e003300=040600;0e003400=040500;0e003500=040400;0e003600=040300;0e003700=040200;0e003800=040100;0e003900=040000;0f000a00=052f00;0f000b00=052e00;0f000c00=052d00;0f000d00=052c00;0f000e00=052b00;0f000f00=052a00;0f001000=052900;0f001100=052800;0f001200=052700;0f001300=052600;0f001400=052500;0f001500=052400;0f001600=052300;0f001700=052200;0f001800=052100;0f001900=052000;0f001a00=051f00;0f001b00=051e00;0f001c00=051d00;0f001d00=051c00;0f001e00=051b00;0f001f00=051a00;0f002000=051900;0f002100=051800;0f002200=051700;0f002300=051600;0f002400=051500;0f002500=051400;0f002600=051300;0f002700=051200;0f002800=051100;0f002900=051000;0f002a00=050f00;0f002b00=050e00;0f002c00=050d00;0f002d00=050c00;0f002e00=050b00;0f002f00=050a00;0f003000=050900;0f003100=050800;0f003200=050700;0f003300=050600;0f003400=050500;0f003500=050400;0f003600=050300;0f003700=050200;0f003800=050100;0f003900=050000;10000a00=062f00;10000b00=062e00;10000c00=062d00;10000d00=062c00;10000e00=062b00;10000f00=062a00;10001000=062900;10001100=062800;10001200=062700;10001300=062600;10001400=062500;10001500=062400;10001600=062300;10001700=062200;10001800=062100;10001900=062000;10001a00=061f00;10001b00=061e00;10001c00=061d00;10001d00=061c00;10001e00=061b00;10001f00=061a00;10002000=061900;10002100=061800;10002200=061700;10002300=061600;10002400=061500;10002500=061400;10002600=061300;10002700=061200;10002800=061100;10002900=061000;10002a00=060f00;10002b00=060e00;10002c00=060d00;10002d00=060c00;10002e00=060b00;10002f00=060a00;10003000=060900;10003100=060800;10003200=060700;10003300=060600;10003400=060500;10003500=060400;10003600=060300;10003700=060200;10003800=060100;10003900=060000;11000a00=072f00;11000b00=072e00;11000c00=072d00;11000d00=072c00;11000e00=072b00;11000f00=072a00;11001000=072900;1010=072800;11001200=072700;11001300=072600;11001400=072500;11001500=072400;11001600=072300;11001700=072200;11001800=072100;11001900=072000;11001a00=071f00;11001b00=071e00;11001c00=071d00;11001d00=071c00;11001e00=071b00;11001f00=071a00;11002000=071900;11002100=071800;1020=071700;11002300=071600;11002400=071500;11002500=071400;11002600=071300;11002700=071200;11002800=071100;11002900=071000;11002a00=070f00;11002b00=070e00;11002c00=070d00;11002d00=070c00;11002e00=070b00;11002f00=070a00;11003000=070900;11003100=070800;11003200=070700;1030=070600;11003400=070500;11003500=070400;11003600=070300;11003700=070200;11003800=070100;11003900=070000;12000a00=082f00;12000b00=082e00;12000c00=082d00;12000d00=082c00;12000e00=082b00;12000f00=082a00;12001000=082900;12001100=082800;12001200=082700;12001300=082600;12001400=082500;12001500=082400;12001600=082300;12001700=082200;12001800=082100;12001900=082000;12001a00=081f00;12001b00=081e00;12001c00=081d00;12001d00=081c00;12001e00=081b00;12001f00=081a00;12002000=081900;12002100=081800;12002200=081700;12002300=081600;12002400=081500;12002500=081400;12002600=081300;12002700=081200;12002800=081100;12002900=081000;12002a00=080f00;12002b00=080e00;12002c00=080d00;12002d00=080c00;12002e00=080b00;12002f00=080a00;12003000=080900;12003100=080800;12003200=080700;12003300=080600;12003400=080500;12003500=080400;12003600=080300;12003700=080200;12003800=080100;12003900=080000;13000a00=092f00;13000b00=092e00;13000c00=092d00;13000d00=092c00;13000e00=092b00;13000f00=092a00;13001000=092900;13001100=092800;13001200=092700;13001300=092600;13001400=092500;13001500=092400;13001600=092300;13001700=092200;13001800=092100;13001900=092000;13001a00=091f00;13001b00=091e00;13001c00=091d00;13001d00=091c00;13001e00=091b00;13001f00=091a00;13002000=091900;13002100=091800;13002200=091700;13002300=091600;13002400=091500;13002500=091400;13002600=091300;13002700=091200;13002800=091100;13002900=091000;13002a00=090f00;13002b00=090e00;13002c00=090d00;13002d00=090c00;13002e00=090b00;13002f00=090a00;13003000=090900;13003100=090800;13003200=090700;13003300=090600;13003400=090500;13003500=090400;13003600=090300;13003700=090200;13003800=090100;13003900=090000;14000a00=0a2f00;14000b00=0a2e00;14000c00=0a2d00;14000d00=0a2c00;14000e00=0a2b00;14000f00=0a2a00;14001000=0a2900;14001100=0a2800;14001200=0a2700;14001300=0a2600;14001400=0a2500;14001500=0a2400;14001600=0a2300;14001700=0a2200;14001800=0a2100;14001900=0a2000;14001a00=0a1f00;14001b00=0a1e00;14001c00=0a1d00;14001d00=0a1c00;14001e00=0a1b00;14001f00=0a1a00;14002000=0a1900;14002100=0a1800;14002200=0a1700;14002300=0a1600;14002400=0a1500;14002500=0a1400;14002600=0a1300;14002700=0a1200;14002800=0a1100;14002900=0a1000;14002a00=0a0f00;14002b00=0a0e00;14002c00=0a0d00;14002d00=0a0c00;14002e00=0a0b00;14002f00=0a0a00;14003000=0a0900;14003100=0a0800;14003200=0a0700;14003300=0a0600;14003400=0a0500;14003500=0a0400;14003600=0a0300;14003700=0a0200;14003800=0a0100;14003900=0a0000;15000a00=0b2f00;15000b00=0b2e00;15000c00=0b2d00;15000d00=0b2c00;15000e00=0b2b00;15000f00=0b2a00;15001000=0b2900;15001100=0b2800;15001200=0b2700;15001300=0b2600;15001400=0b2500;15001500=0b2400;15001600=0b2300;15001700=0b2200;15001800=0b2100;15001900=0b2000;15001a00=0b1f00;15001b00=0b1e00;15001c00=0b1d00;15001d00=0b1c00;15001e00=0b1b00;15001f00=0b1a00;15002000=0b1900;15002100=0b1800;15002200=0b1700;15002300=0b1600;15002400=0b1500;15002500=0b1400;15002600=0b1300;15002700=0b1200;15002800=0b1100;15002900=0b1000;15002a00=0b0f00;15002b00=0b0e00;15002c00=0b0d00;15002d00=0b0c00;15002e00=0b0b00;15002f00=0b0a00;15003000=0b0900;15003100=0b0800;15003200=0b0700;15003300=0b0600;15003400=0b0500;15003500=0b0400;15003600=0b0300;15003700=0b0200;15003800=0b0100;15003900=0b0000;16000a00=0c2f00;16000b00=0c2e00;16000c00=0c2d00;16000d00=0c2c00;16000e00=0c2b00;16000f00=0c2a00;16001000=0c2900;16001100=0c2800;16001200=0c2700;16001300=0c2600;16001400=0c2500;16001500=0c2400;16001600=0c2300;16001700=0c2200;16001800=0c2100;16001900=0c2000;16001a00=0c1f00;16001b00=0c1e00;16001c00=0c1d00;16001d00=0c1c00;16001e00=0c1b00;16001f00=0c1a00;16002000=0c1900;16002100=0c1800;16002200=0c1700;16002300=0c1600;16002400=0c1500;16002500=0c1400;16002600=0c1300;16002700=0c1200;16002800=0c1100;16002900=0c1000;16002a00=0c0f00;16002b00=0c0e00;16002c00=0c0d00;16002d00=0c0c00;16002e00=0c0b00;16002f00=0c0a00;16003000=0c0900;16003100=0c0800;16003200=0c0700;16003300=0c0600;16003400=0c0500;16003500=0c0400;16003600=0c0300;16003700=0c0200;16003800=0c0100;16003900=0c0000;17000a00=0d2f00;17000b00=0d2e00;17000c00=0d2d00;17000d00=0d2c00;17000e00=0d2b00;17000f00=0d2a00;17001000=0d2900;17001100=0d2800;17001200=0d2700;17001300=0d2600;17001400=0d2500;17001500=0d2400;17001600=0d2300;17001700=0d2200;17001800=0d2100;17001900=0d2000;17001a00=0d1f00;17001b00=0d1e00;17001c00=0d1d00;17001d00=0d1c00;17001e00=0d1b00;17001f00=0d1a00;17002000=0d1900;17002100=0d1800;17002200=0d1700;17002300=0d1600;17002400=0d1500;17002500=0d1400;17002600=0d1300;17002700=0d1200;17002800=0d1100;17002900=0d1000;17002a00=0d0f00;17002b00=0d0e00;17002c00=0d0d00;17002d00=0d0c00;17002e00=0d0b00;17002f00=0d0a00;17003000=0d0900;17003100=0d0800;17003200=0d0700;17003300=0d0600;17003400=0d0500;17003500=0d0400;17003600=0d0300;17003700=0d0200;17003800=0d0100;17003900=0d0000;18000a00=0e2f00;18000b00=0e2e00;18000c00=0e2d00;18000d00=0e2c00;18000e00=0e2b00;18000f00=0e2a00;18001000=0e2900;18001100=0e2800;18001200=0e2700;18001300=0e2600;18001400=0e2500;18001500=0e2400;18001600=0e2300;18001700=0e2200;18001800=0e2100;18001900=0e2000;18001a00=0e1f00;18001b00=0e1e00;18001c00=0e1d00;18001d00=0e1c00;18001e00=0e1b00;18001f00=0e1a00;18002000=0e1900;18002100=0e1800;18002200=0e1700;18002300=0e1600;18002400=0e1500;18002500=0e1400;18002600=0e1300;18002700=0e1200;18002800=0e1100;18002900=0e1000;18002a00=0e0f00;18002b00=0e0e00;18002c00=0e0d00;18002d00=0e0c00;18002e00=0e0b00;18002f00=0e0a00;18003000=0e0900;18003100=0e0800;18003200=0e0700;18003300=0e0600;18003400=0e0500;18003500=0e0400;18003600=0e0300;18003700=0e0200;18003800=0e0100;18003900=0e0000;19000a00=0f2f00;19000b00=0f2e00;19000c00=0f2d00;19000d00=0f2c00;19000e00=0f2b00;19000f00=0f2a00;19001000=0f2900;19001100=0f2800;19001200=0f2700;19001300=0f2600;19001400=0f2500;19001500=0f2400;19001600=0f2300;19001700=0f2200;19001800=0f2100;19001900=0f2000;19001a00=0f1f00;19001b00=0f1e00;19001c00=0f1d00;19001d00=0f1c00;19001e00=0f1b00;19001f00=0f1a00;19002000=0f1900;19002100=0f1800;19002200=0f1700;19002300=0f1600;19002400=0f1500;19002500=0f1400;19002600=0f1300;19002700=0f1200;19002800=0f1100;19002900=0f1000;19002a00=0f0f00;19002b00=0f0e00;19002c00=0f0d00;19002d00=0f0c00;19002e00=0f0b00;19002f00=0f0a00;19003000=0f0900;19003100=0f0800;19003200=0f0700;19003300=0f0600;19003400=0f0500;19003500=0f0400;19003600=0f0300;19003700=0f0200;19003800=0f0100;19003900=0f0000;1a000a00=102f00;1a000b00=102e00;1a000c00=102d00;1a000d00=102c00;1a000e00=102b00;1a000f00=102a00;1a001000=102900;1a001100=102800;1a001200=102700;1a001300=102600;1a001400=102500;1a001500=102400;1a001600=102300;1a001700=102200;1a001800=102100;1a001900=102000;1a001a00=101f00;1a001b00=101e00;1a001c00=101d00;1a001d00=101c00;1a001e00=101b00;1a001f00=101a00;1a002000=101900;1a002100=101800;1a002200=101700;1a002300=101600;1a002400=101500;1a002500=101400;1a002600=101300;1a002700=101200;1a002800=101100;1a002900=101000;1a002a00=100f00;1a002b00=100e00;1a002c00=100d00;1a002d00=100c00;1a002e00=100b00;1a002f00=100a00;1a003000=100900;1a003100=100800;1a003200=100700;1a003300=100600;1a003400=100500;1a003500=100400;1a003600=100300;1a003700=100200;1a003800=100100;1a003900=100000;1b000a00=112f00;1b000b00=112e00;1b000c00=112d00;1b000d00=112c00;1b000e00=112b00;1b000f00=112a00;1b001000=112900;1b001100=112800;1b001200=112700;1b001300=112600;1b001400=112500;1b001500=112400;1b001600=112300;1b001700=120;1b001800=112100;1b001900=112000;1b001a00=111f00;1b001b00=111e00;1b001c00=111d00;1b001d00=111c00;1b001e00=111b00;1b001f00=111a00;1b002000=111900;1b002100=111800;1b002200=111700;1b002300=111600;1b002400=111500;1b002500=111400;1b002600=111300;1b002700=111200;1b002800=110;1b002900=111000;1b002a00=110f00;1b002b00=110e00;1b002c00=110d00;1b002d00=110c00;1b002e00=110b00;1b002f00=110a00;1b003000=110900;1b003100=110800;1b003200=110700;1b003300=110600;1b003400=110500;1b003500=110400;1b003600=110300;1b003700=110200;1b003800=110100;1b003900=100;1c000a00=122f00;1c000b00=122e00;1c000c00=122d00;1c000d00=122c00;1c000e00=122b00;1c000f00=122a00;1c001000=122900;1c001100=122800;1c001200=122700;1c001300=122600;1c001400=122500;1c001500=122400;1c001600=122300;1c001700=122200;1c001800=122100;1c001900=122000;1c001a00=121f00;1c001b00=121e00;1c001c00=121d00;1c001d00=121c00;1c001e00=121b00;1c001f00=121a00;1c002000=121900;1c002100=121800;1c002200=121700;1c002300=121600;1c002400=121500;1c002500=121400;1c002600=121300;1c002700=121200;1c002800=121100;1c002900=121000;1c002a00=120f00;1c002b00=120e00;1c002c00=120d00;1c002d00=120c00;1c002e00=120b00;1c002f00=120a00;1c003000=120900;1c003100=120800;1c003200=120700;1c003300=120600;1c003400=120500;1c003500=120400;1c003600=120300;1c003700=120200;1c003800=120100;1c003900=120000;1d000a00=132f00;1d000b00=132e00;1d000c00=132d00;1d000d00=132c00;1d000e00=132b00;1d000f00=132a00;1d001000=132900;1d001100=132800;1d001200=132700;1d001300=132600;1d001400=132500;1d001500=132400;1d001600=132300;1d001700=132200;1d001800=132100;1d001900=132000;1d001a00=131f00;1d001b00=131e00;1d001c00=131d00;1d001d00=131c00;1d001e00=131b00;1d001f00=131a00;1d002000=131900;1d002100=131800;1d002200=131700;1d002300=131600;1d002400=131500;1d002500=131400;1d002600=131300;1d002700=131200;1d002800=131100;1d002900=131000;1d002a00=130f00;1d002b00=130e00;1d002c00=130d00;1d002d00=130c00;1d002e00=130b00;1d002f00=130a00;1d003000=130900;1d003100=130800;1d003200=130700;1d003300=130600;1d003400=130500;1d003500=130400;1d003600=130300;1d003700=130200;1d003800=130100;1d003900=130000;1e000a00=142f00;1e000b00=142e00;1e000c00=142d00;1e000d00=142c00;1e000e00=142b00;1e000f00=142a00;1e001000=142900;1e001100=142800;1e001200=142700;1e001300=142600;1e001400=142500;1e001500=142400;1e001600=142300;1e001700=142200;1e001800=142100;1e001900=142000;1e001a00=141f00;1e001b00=141e00;1e001c00=141d00;1e001d00=141c00;1e001e00=141b00;1e001f00=141a00;1e002000=141900;1e002100=141800;1e002200=141700;1e002300=141600;1e002400=141500;1e002500=141400;1e002600=141300;1e002700=141200;1e002800=141100;1e002900=141000;1e002a00=140f00;1e002b00=140e00;1e002c00=140d00;1e002d00=140c00;1e002e00=140b00;1e002f00=140a00;1e003000=140900;1e003100=140800;1e003200=140700;1e003300=140600;1e003400=140500;1e003500=140400;1e003600=140300;1e003700=140200;1e003800=140100;1e003900=140000;1f000a00=152f00;1f000b00=152e00;1f000c00=152d00;1f000d00=152c00;1f000e00=152b00;1f000f00=152a00;1f001000=152900;1f001100=152800;1f001200=152700;1f001300=152600;1f001400=152500;1f001500=152400;1f001600=152300;1f001700=152200;1f001800=152100;1f001900=152000;1f001a00=151f00;1f001b00=151e00;1f001c00=151d00;1f001d00=151c00;1f001e00=151b00;1f001f00=151a00;1f002000=151900;1f002100=151800;1f002200=151700;1f002300=151600;1f002400=151500;1f002500=151400;1f002600=151300;1f002700=151200;1f002800=151100;1f002900=151000;1f002a00=150f00;1f002b00=150e00;1f002c00=150d00;1f002d00=150c00;1f002e00=150b00;1f002f00=150a00;1f003000=150900;1f003100=150800;1f003200=150700;1f003300=150600;1f003400=150500;1f003500=150400;1f003600=150300;1f003700=150200;1f003800=150100;1f003900=150000;20000a00=162f00;20000b00=162e00;20000c00=162d00;20000d00=162c00;20000e00=162b00;20000f00=162a00;20001000=162900;20001100=162800;20001200=162700;20001300=162600;20001400=162500;20001500=162400;20001600=162300;20001700=162200;20001800=162100;20001900=162000;20001a00=161f00;20001b00=161e00;20001c00=161d00;20001d00=161c00;20001e00=161b00;20001f00=161a00;20002000=161900;20002100=161800;20002200=161700;20002300=161600;20002400=161500;20002500=161400;20002600=161300;20002700=161200;20002800=161100;20002900=161000;20002a00=160f00;20002b00=160e00;20002c00=160d00;20002d00=160c00;20002e00=160b00;20002f00=160a00;20003000=160900;20003100=160800;20003200=160700;20003300=160600;20003400=160500;20003500=160400;20003600=160300;20003700=160200;20003800=160100;20003900=160000;21000a00=172f00;21000b00=172e00;21000c00=172d00;21000d00=172c00;21000e00=172b00;21000f00=172a00;21001000=172900;21001100=172800;21001200=172700;21001300=172600;21001400=172500;21001500=172400;21001600=172300;21001700=172200;21001800=172100;21001900=172000;21001a00=171f00;21001b00=171e00;21001c00=171d00;21001d00=171c00;21001e00=171b00;21001f00=171a00;21002000=171900;21002100=171800;21002200=171700;21002300=171600;21002400=171500;21002500=171400;21002600=171300;21002700=171200;21002800=171100;21002900=171000;21002a00=170f00;21002b00=170e00;21002c00=170d00;21002d00=170c00;21002e00=170b00;21002f00=170a00;21003000=170900;21003100=170800;21003200=170700;21003300=170600;21003400=170500;21003500=170400;21003600=170300;21003700=170200;21003800=170100;21003900=170000;22000a00=182f00;22000b00=182e00;22000c00=182d00;22000d00=182c00;22000e00=182b00;22000f00=182a00;22001000=182900;2010=182800;22001200=182700;22001300=182600;22001400=182500;22001500=182400;22001600=182300;22001700=182200;22001800=182100;22001900=182000;22001a00=181f00;22001b00=181e00;22001c00=181d00;22001d00=181c00;22001e00=181b00;22001f00=181a00;22002000=181900;22002100=181800;2020=181700;22002300=181600;22002400=181500;22002500=181400;22002600=181300;22002700=181200;22002800=181100;22002900=181000;22002a00=180f00;22002b00=180e00;22002c00=180d00;22002d00=180c00;22002e00=180b00;22002f00=180a00;22003000=180900;22003100=180800;22003200=180700;2030=180600;22003400=180500;22003500=180400;22003600=180300;22003700=180200;22003800=180100;22003900=180000;23000a00=192f00;23000b00=192e00;23000c00=192d00;23000d00=192c00;23000e00=192b00;23000f00=192a00;23001000=192900;23001100=192800;23001200=192700;23001300=192600;23001400=192500;23001500=192400;23001600=192300;23001700=192200;23001800=192100;23001900=192000;23001a00=191f00;23001b00=191e00;23001c00=191d00;23001d00=191c00;23001e00=191b00;23001f00=191a00;23002000=191900;23002100=191800;23002200=191700;23002300=191600;23002400=191500;23002500=191400;23002600=191300;23002700=191200;23002800=191100;23002900=191000;23002a00=190f00;23002b00=190e00;23002c00=190d00;23002d00=190c00;23002e00=190b00;23002f00=190a00;23003000=190900;23003100=190800;23003200=190700;23003300=190600;23003400=190500;23003500=190400;23003600=190300;23003700=190200;23003800=190100;23003900=190000;24000a00=1a2f00;24000b00=1a2e00;24000c00=1a2d00;24000d00=1a2c00;24000e00=1a2b00;24000f00=1a2a00;24001000=1a2900;24001100=1a2800;24001200=1a2700;24001300=1a2600;24001400=1a2500;24001500=1a2400;24001600=1a2300;24001700=1a2200;24001800=1a2100;24001900=1a2000;24001a00=1a1f00;24001b00=1a1e00;24001c00=1a1d00;24001d00=1a1c00;24001e00=1a1b00;24001f00=1a1a00;24002000=1a1900;24002100=1a1800;24002200=1a1700;24002300=1a1600;24002400=1a1500;24002500=1a1400;24002600=1a1300;24002700=1a1200;24002800=1a1100;24002900=1a1000;24002a00=1a0f00;24002b00=1a0e00;24002c00=1a0d00;24002d00=1a0c00;24002e00=1a0b00;24002f00=1a0a00;24003000=1a0900;24003100=1a0800;24003200=1a0700;24003300=1a0600;24003400=1a0500;24003500=1a0400;24003600=1a0300;24003700=1a0200;24003800=1a0100;24003900=1a0000;25000a00=1b2f00;25000b00=1b2e00;25000c00=1b2d00;25000d00=1b2c00;25000e00=1b2b00;25000f00=1b2a00;25001000=1b2900;25001100=1b2800;25001200=1b2700;25001300=1b2600;25001400=1b2500;25001500=1b2400;25001600=1b2300;25001700=1b2200;25001800=1b2100;25001900=1b2000;25001a00=1b1f00;25001b00=1b1e00;25001c00=1b1d00;25001d00=1b1c00;25001e00=1b1b00;25001f00=1b1a00;25002000=1b1900;25002100=1b1800;25002200=1b1700;25002300=1b1600;25002400=1b1500;25002500=1b1400;25002600=1b1300;25002700=1b1200;25002800=1b1100;25002900=1b1000;25002a00=1b0f00;25002b00=1b0e00;25002c00=1b0d00;25002d00=1b0c00;25002e00=1b0b00;25002f00=1b0a00;25003000=1b0900;25003100=1b0800;25003200=1b0700;25003300=1b0600;25003400=1b0500;25003500=1b0400;25003600=1b0300;25003700=1b0200;25003800=1b0100;25003900=1b0000;26000a00=1c2f00;26000b00=1c2e00;26000c00=1c2d00;26000d00=1c2c00;26000e00=1c2b00;26000f00=1c2a00;26001000=1c2900;26001100=1c2800;26001200=1c2700;26001300=1c2600;26001400=1c2500;26001500=1c2400;26001600=1c2300;26001700=1c2200;26001800=1c2100;26001900=1c2000;26001a00=1c1f00;26001b00=1c1e00;26001c00=1c1d00;26001d00=1c1c00;26001e00=1c1b00;26001f00=1c1a00;26002000=1c1900;26002100=1c1800;26002200=1c1700;26002300=1c1600;26002400=1c1500;26002500=1c1400;26002600=1c1300;26002700=1c1200;26002800=1c1100;26002900=1c1000;26002a00=1c0f00;26002b00=1c0e00;26002c00=1c0d00;26002d00=1c0c00;26002e00=1c0b00;26002f00=1c0a00;26003000=1c0900;26003100=1c0800;26003200=1c0700;26003300=1c0600;26003400=1c0500;26003500=1c0400;26003600=1c0300;26003700=1c0200;26003800=1c0100;26003900=1c0000;27000a00=1d2f00;27000b00=1d2e00;27000c00=1d2d00;27000d00=1d2c00;27000e00=1d2b00;27000f00=1d2a00;27001000=1d2900;27001100=1d2800;27001200=1d2700;27001300=1d2600;27001400=1d2500;27001500=1d2400;27001600=1d2300;27001700=1d2200;27001800=1d2100;27001900=1d2000;27001a00=1d1f00;27001b00=1d1e00;27001c00=1d1d00;27001d00=1d1c00;27001e00=1d1b00;27001f00=1d1a00;27002000=1d1900;27002100=1d1800;27002200=1d1700;27002300=1d1600;27002400=1d1500;27002500=1d1400;27002600=1d1300;27002700=1d1200;27002800=1d1100;27002900=1d1000;27002a00=1d0f00;27002b00=1d0e00;27002c00=1d0d00;27002d00=1d0c00;27002e00=1d0b00;27002f00=1d0a00;27003000=1d0900;27003100=1d0800;27003200=1d0700;27003300=1d0600;27003400=1d0500;27003500=1d0400;27003600=1d0300;27003700=1d0200;27003800=1d0100;27003900=1d0000;28000a00=1e2f00;28000b00=1e2e00;28000c00=1e2d00;28000d00=1e2c00;28000e00=1e2b00;28000f00=1e2a00;28001000=1e2900;28001100=1e2800;28001200=1e2700;28001300=1e2600;28001400=1e2500;28001500=1e2400;28001600=1e2300;28001700=1e2200;28001800=1e2100;28001900=1e2000;28001a00=1e1f00;28001b00=1e1e00;28001c00=1e1d00;28001d00=1e1c00;28001e00=1e1b00;28001f00=1e1a00;28002000=1e1900;28002100=1e1800;28002200=1e1700;28002300=1e1600;28002400=1e1500;28002500=1e1400;28002600=1e1300;28002700=1e1200;28002800=1e1100;28002900=1e1000;28002a00=1e0f00;28002b00=1e0e00;28002c00=1e0d00;28002d00=1e0c00;28002e00=1e0b00;28002f00=1e0a00;28003000=1e0900;28003100=1e0800;28003200=1e0700;28003300=1e0600;28003400=1e0500;28003500=1e0400;28003600=1e0300;28003700=1e0200;28003800=1e0100;28003900=1e0000;29000a00=1f2f00;29000b00=1f2e00;29000c00=1f2d00;29000d00=1f2c00;29000e00=1f2b00;29000f00=1f2a00;29001000=1f2900;29001100=1f2800;29001200=1f2700;29001300=1f2600;29001400=1f2500;29001500=1f2400;29001600=1f2300;29001700=1f2200;29001800=1f2100;29001900=1f2000;29001a00=1f1f00;29001b00=1f1e00;29001c00=1f1d00;29001d00=1f1c00;29001e00=1f1b00;29001f00=1f1a00;29002000=1f1900;29002100=1f1800;29002200=1f1700;29002300=1f1600;29002400=1f1500;29002500=1f1400;29002600=1f1300;29002700=1f1200;29002800=1f1100;29002900=1f1000;29002a00=1f0f00;29002b00=1f0e00;29002c00=1f0d00;29002d00=1f0c00;29002e00=1f0b00;29002f00=1f0a00;29003000=1f0900;29003100=1f0800;29003200=1f0700;29003300=1f0600;29003400=1f0500;29003500=1f0400;29003600=1f0300;29003700=1f0200;29003800=1f0100;29003900=1f0000;2a000a00=202f00;2a000b00=202e00;2a000c00=202d00;2a000d00=202c00;2a000e00=202b00;2a000f00=202a00;2a001000=202900;2a001100=202800;2a001200=202700;2a001300=202600;2a001400=202500;2a001500=202400;2a001600=202300;2a001700=202200;2a001800=202100;2a001900=202000;2a001a00=201f00;2a001b00=201e00;2a001c00=201d00;2a001d00=201c00;2a001e00=201b00;2a001f00=201a00;2a002000=201900;2a002100=201800;2a002200=201700;2a002300=201600;2a002400=201500;2a002500=201400;2a002600=201300;2a002700=201200;2a002800=201100;2a002900=201000;2a002a00=200f00;2a002b00=200e00;2a002c00=200d00;2a002d00=200c00;2a002e00=200b00;2a002f00=200a00;2a003000=200900;2a003100=200800;2a003200=200700;2a003300=200600;2a003400=200500;2a003500=200400;2a003600=200300;2a003700=200200;2a003800=200100;2a003900=200000;2b000a00=212f00;2b000b00=212e00;2b000c00=212d00;2b000d00=212c00;2b000e00=212b00;2b000f00=212a00;2b001000=212900;2b001100=212800;2b001200=212700;2b001300=212600;2b001400=212500;2b001500=212400;2b001600=212300;2b001700=212200;2b001800=212100;2b001900=212000;2b001a00=211f00;2b001b00=211e00;2b001c00=211d00;2b001d00=211c00;2b001e00=211b00;2b001f00=211a00;2b002000=211900;2b002100=211800;2b002200=211700;2b002300=211600;2b002400=211500;2b002500=211400;2b002600=211300;2b002700=211200;2b002800=211100;2b002900=211000;2b002a00=210f00;2b002b00=210e00;2b002c00=210d00;2b002d00=210c00;2b002e00=210b00;2b002f00=210a00;2b003000=210900;2b003100=210800;2b003200=210700;2b003300=210600;2b003400=210500;2b003500=210400;2b003600=210300;2b003700=210200;2b003800=210100;2b003900=210000;2c000a00=222f00;2c000b00=222e00;2c000c00=222d00;2c000d00=222c00;2c000e00=222b00;2c000f00=222a00;2c001000=222900;2c001100=222800;2c001200=222700;2c001300=222600;2c001400=222500;2c001500=222400;2c001600=222300;2c001700=220;2c001800=222100;2c001900=222000;2c001a00=221f00;2c001b00=221e00;2c001c00=221d00;2c001d00=221c00;2c001e00=221b00;2c001f00=221a00;2c002000=221900;2c002100=221800;2c002200=221700;2c002300=221600;2c002400=221500;2c002500=221400;2c002600=221300;2c002700=221200;2c002800=210;2c002900=221000;2c002a00=220f00;2c002b00=220e00;2c002c00=220d00;2c002d00=220c00;2c002e00=220b00;2c002f00=220a00;2c003000=220900;2c003100=220800;2c003200=220700;2c003300=220600;2c003400=220500;2c003500=220400;2c003600=220300;2c003700=220200;2c003800=220100;2c003900=200;2d000a00=232f00;2d000b00=232e00;2d000c00=232d00;2d000d00=232c00;2d000e00=232b00;2d000f00=232a00;2d001000=232900;2d001100=232800;2d001200=232700;2d001300=232600;2d001400=232500;2d001500=232400;2d001600=232300;2d001700=232200;2d001800=232100;2d001900=232000;2d001a00=231f00;2d001b00=231e00;2d001c00=231d00;2d001d00=231c00;2d001e00=231b00;2d001f00=231a00;2d002000=231900;2d002100=231800;2d002200=231700;2d002300=231600;2d002400=231500;2d002500=231400;2d002600=231300;2d002700=231200;2d002800=231100;2d002900=231000;2d002a00=230f00;2d002b00=230e00;2d002c00=230d00;2d002d00=230c00;2d002e00=230b00;2d002f00=230a00;2d003000=230900;2d003100=230800;2d003200=230700;2d003300=230600;2d003400=230500;2d003500=230400;2d003600=230300;2d003700=230200;2d003800=230100;2d003900=230000;2e000a00=242f00;2e000b00=242e00;2e000c00=242d00;2e000d00=242c00;2e000e00=242b00;2e000f00=242a00;2e001000=242900;2e001100=242800;2e001200=242700;2e001300=242600;2e001400=242500;2e001500=242400;2e001600=242300;2e001700=242200;2e001800=242100;2e001900=242000;2e001a00=241f00;2e001b00=241e00;2e001c00=241d00;2e001d00=241c00;2e001e00=241b00;2e001f00=241a00;2e002000=241900;2e002100=241800;2e002200=241700;2e002300=241600;2e002400=241500;2e002500=241400;2e002600=241300;2e002700=241200;2e002800=241100;2e002900=241000;2e002a00=240f00;2e002b00=240e00;2e002c00=240d00;2e002d00=240c00;2e002e00=240b00;2e002f00=240a00;2e003000=240900;2e003100=240800;2e003200=240700;2e003300=240600;2e003400=240500;2e003500=240400;2e003600=240300;2e003700=240200;2e003800=240100;2e003900=240000;2f000a00=252f00;2f000b00=252e00;2f000c00=252d00;2f000d00=252c00;2f000e00=252b00;2f000f00=252a00;2f001000=252900;2f001100=252800;2f001200=252700;2f001300=252600;2f001400=252500;2f001500=252400;2f001600=252300;2f001700=252200;2f001800=252100;2f001900=252000;2f001a00=251f00;2f001b00=251e00;2f001c00=251d00;2f001d00=251c00;2f001e00=251b00;2f001f00=251a00;2f002000=251900;2f002100=251800;2f002200=251700;2f002300=251600;2f002400=251500;2f002500=251400;2f002600=251300;2f002700=251200;2f002800=251100;2f002900=251000;2f002a00=250f00;2f002b00=250e00;2f002c00=250d00;2f002d00=250c00;2f002e00=250b00;2f002f00=250a00;2f003000=250900;2f003100=250800;2f003200=250700;2f003300=250600;2f003400=250500;2f003500=250400;2f003600=250300;2f003700=250200;2f003800=250100;2f003900=250000;30000a00=262f00;30000b00=262e00;30000c00=262d00;30000d00=262c00;30000e00=262b00;30000f00=262a00;30001000=262900;30001100=262800;30001200=262700;30001300=262600;30001400=262500;30001500=262400;30001600=262300;30001700=262200;30001800=262100;30001900=262000;30001a00=261f00;30001b00=261e00;30001c00=261d00;30001d00=261c00;30001e00=261b00;30001f00=261a00;30002000=261900;30002100=261800;30002200=261700;30002300=261600;30002400=261500;30002500=261400;30002600=261300;30002700=261200;30002800=261100;30002900=261000;30002a00=260f00;30002b00=260e00;30002c00=260d00;30002d00=260c00;30002e00=260b00;30002f00=260a00;30003000=260900;30003100=260800;30003200=260700;30003300=260600;30003400=260500;30003500=260400;30003600=260300;30003700=260200;30003800=260100;30003900=260000;31000a00=272f00;31000b00=272e00;31000c00=272d00;31000d00=272c00;31000e00=272b00;31000f00=272a00;31001000=272900;31001100=272800;31001200=272700;31001300=272600;31001400=272500;31001500=272400;31001600=272300;31001700=272200;31001800=272100;31001900=272000;31001a00=271f00;31001b00=271e00;31001c00=271d00;31001d00=271c00;31001e00=271b00;31001f00=271a00;31002000=271900;31002100=271800;31002200=271700;31002300=271600;31002400=271500;31002500=271400;31002600=271300;31002700=271200;31002800=271100;31002900=271000;31002a00=270f00;31002b00=270e00;31002c00=270d00;31002d00=270c00;31002e00=270b00;31002f00=270a00;31003000=270900;31003100=270800;31003200=270700;31003300=270600;31003400=270500;31003500=270400;31003600=270300;31003700=270200;31003800=270100;31003900=270000;32000a00=282f00;32000b00=282e00;32000c00=282d00;32000d00=282c00;32000e00=282b00;32000f00=282a00;32001000=282900;32001100=282800;32001200=282700;32001300=282600;32001400=282500;32001500=282400;32001600=282300;32001700=282200;32001800=282100;32001900=282000;32001a00=281f00;32001b00=281e00;32001c00=281d00;32001d00=281c00;32001e00=281b00;32001f00=281a00;32002000=281900;32002100=281800;32002200=281700;32002300=281600;32002400=281500;32002500=281400;32002600=281300;32002700=281200;32002800=281100;32002900=281000;32002a00=280f00;32002b00=280e00;32002c00=280d00;32002d00=280c00;32002e00=280b00;32002f00=280a00;32003000=280900;32003100=280800;32003200=280700;32003300=280600;32003400=280500;32003500=280400;32003600=280300;32003700=280200;32003800=280100;32003900=280000;33000a00=292f00;33000b00=292e00;33000c00=292d00;33000d00=292c00;33000e00=292b00;33000f00=292a00;33001000=292900;3010=292800;33001200=292700;33001300=292600;33001400=292500;33001500=292400;33001600=292300;33001700=292200;33001800=292100;33001900=292000;33001a00=291f00;33001b00=291e00;33001c00=291d00;33001d00=291c00;33001e00=291b00;33001f00=291a00;33002000=291900;33002100=291800;3020=291700;33002300=291600;33002400=291500;33002500=291400;33002600=291300;33002700=291200;33002800=291100;33002900=291000;33002a00=290f00;33002b00=290e00;33002c00=290d00;33002d00=290c00;33002e00=290b00;33002f00=290a00;33003000=290900;33003100=290800;33003200=290700;3030=290600;33003400=290500;33003500=290400;33003600=290300;33003700=290200;33003800=290100;33003900=290000;34000a00=2a2f00;34000b00=2a2e00;34000c00=2a2d00;34000d00=2a2c00;34000e00=2a2b00;34000f00=2a2a00;34001000=2a2900;34001100=2a2800;34001200=2a2700;34001300=2a2600;34001400=2a2500;34001500=2a2400;34001600=2a2300;34001700=2a2200;34001800=2a2100;34001900=2a2000;34001a00=2a1f00;34001b00=2a1e00;34001c00=2a1d00;34001d00=2a1c00;34001e00=2a1b00;34001f00=2a1a00;34002000=2a1900;34002100=2a1800;34002200=2a1700;34002300=2a1600;34002400=2a1500;34002500=2a1400;34002600=2a1300;34002700=2a1200;34002800=2a1100;34002900=2a1000;34002a00=2a0f00;34002b00=2a0e00;34002c00=2a0d00;34002d00=2a0c00;34002e00=2a0b00;34002f00=2a0a00;34003000=2a0900;34003100=2a0800;34003200=2a0700;34003300=2a0600;34003400=2a0500;34003500=2a0400;34003600=2a0300;34003700=2a0200;34003800=2a0100;34003900=2a0000;35000a00=2b2f00;35000b00=2b2e00;35000c00=2b2d00;35000d00=2b2c00;35000e00=2b2b00;35000f00=2b2a00;35001000=2b2900;35001100=2b2800;35001200=2b2700;35001300=2b2600;35001400=2b2500;35001500=2b2400;35001600=2b2300;35001700=2b2200;35001800=2b2100;35001900=2b2000;35001a00=2b1f00;35001b00=2b1e00;35001c00=2b1d00;35001d00=2b1c00;35001e00=2b1b00;35001f00=2b1a00;35002000=2b1900;35002100=2b1800;35002200=2b1700;35002300=2b1600;35002400=2b1500;35002500=2b1400;35002600=2b1300;35002700=2b1200;35002800=2b1100;35002900=2b1000;35002a00=2b0f00;35002b00=2b0e00;35002c00=2b0d00;35002d00=2b0c00;35002e00=2b0b00;35002f00=2b0a00;35003000=2b0900;35003100=2b0800;35003200=2b0700;35003300=2b0600;35003400=2b0500;35003500=2b0400;35003600=2b0300;35003700=2b0200;35003800=2b0100;35003900=2b0000;36000a00=2c2f00;36000b00=2c2e00;36000c00=2c2d00;36000d00=2c2c00;36000e00=2c2b00;36000f00=2c2a00;36001000=2c2900;36001100=2c2800;36001200=2c2700;36001300=2c2600;36001400=2c2500;36001500=2c2400;36001600=2c2300;36001700=2c2200;36001800=2c2100;36001900=2c2000;36001a00=2c1f00;36001b00=2c1e00;36001c00=2c1d00;36001d00=2c1c00;36001e00=2c1b00;36001f00=2c1a00;36002000=2c1900;36002100=2c1800;36002200=2c1700;36002300=2c1600;36002400=2c1500;36002500=2c1400;36002600=2c1300;36002700=2c1200;36002800=2c1100;36002900=2c1000;36002a00=2c0f00;36002b00=2c0e00;36002c00=2c0d00;36002d00=2c0c00;36002e00=2c0b00;36002f00=2c0a00;36003000=2c0900;36003100=2c0800;36003200=2c0700;36003300=2c0600;36003400=2c0500;36003500=2c0400;36003600=2c0300;36003700=2c0200;36003800=2c0100;36003900=2c0000;37000a00=2d2f00;37000b00=2d2e00;37000c00=2d2d00;37000d00=2d2c00;37000e00=2d2b00;37000f00=2d2a00;37001000=2d2900;37001100=2d2800;37001200=2d2700;37001300=2d2600;37001400=2d2500;37001500=2d2400;37001600=2d2300;37001700=2d2200;37001800=2d2100;37001900=2d2000;37001a00=2d1f00;37001b00=2d1e00;37001c00=2d1d00;37001d00=2d1c00;37001e00=2d1b00;37001f00=2d1a00;37002000=2d1900;37002100=2d1800;37002200=2d1700;37002300=2d1600;37002400=2d1500;37002500=2d1400;37002600=2d1300;37002700=2d1200;37002800=2d1100;37002900=2d1000;37002a00=2d0f00;37002b00=2d0e00;37002c00=2d0d00;37002d00=2d0c00;37002e00=2d0b00;37002f00=2d0a00;37003000=2d0900;37003100=2d0800;37003200=2d0700;37003300=2d0600;37003400=2d0500;37003500=2d0400;37003600=2d0300;37003700=2d0200;37003800=2d0100;37003900=2d0000?multiply=ffffff01"

	status.setStatusProperty("impRadioCanOpen",false)

	listPath = "playerScrollArea.playerList"
	textboxPath = "textboxMessage"
	fileTextboxPath = "textboxFile"
	universalTickCounter = 0
	selectedId = player.id()
	mode = 1
	radioPreview = widget.bindCanvas("radioPreview")

	savedImages = status.statusProperty("impRadioImages",{})

	for k, v in pairs(savedImages) do
		if v.scaleFactor == nil then
			savedImages[k].scaleFactor = 3
		end
	end

	updatePreview()
end

function update()
	universalTickCounter = universalTickCounter + 1
	if universalTickCounter % 30 == 1 then
		populateList()
	end
	local selectedItem = widget.getListSelected(listPath)
	if selectedItem ~= nil then
		selectedId = widget.getData(listPath .. "." .. selectedItem)
	else
		selectedId = player.id()
	end
	radioString = widget.getText(textboxPath)
end

function uninit()
	status.setStatusProperty("impRadioImages",savedImages)
	status.setStatusProperty("impRadioCanOpen",true)
end

function privateMessage()
	local selectedItem = widget.getListSelected(listPath)
	if selectedItem ~= nil then
		local targetPlayer = widget.getData(listPath .. "." .. selectedItem)
		radioString = "Message to " .. cutColors(world.entityName(targetPlayer)) .. ": " .. radioString
		sendRadioMessage(player.id())
		sendRadioMessage(targetPlayer)
	end
	widget.setText(textboxPath,"")
end

function publicMessage()
	local nearPlayers = world.playerQuery(world.entityPosition(player.id()),200)
	i = 0
	for player in ipairs(nearPlayers) do
		i = i + 1
		sendRadioMessage(nearPlayers[i])
	end
	widget.setText(textboxPath,"")
end

function modeRight()
	mode = mode + 1
	local imageCount = 0
	for _, _ in pairs(savedImages) do
		imageCount = imageCount + 1
	end
	if mode > imageCount then
		mode = 1
	end
	updatePreview()
end

function modeLeft()
	mode = mode - 1
	local imageCount = 0
	for _, _ in pairs(savedImages) do
		imageCount = imageCount + 1
	end
	if mode < 1 then
		mode = imageCount
	end
	updatePreview()
end

function addMode()
	local config = root.assetJson("/interface/improvedRadioScanner.json")
	local fileName = widget.getText(fileTextboxPath)
	if fileName ~= nil and fileName ~= "" and string.find(fileName,".") ~= nil then -- gotta make sure it's a valid file path
		config.customPortrait = "/improvedRadio/customPortraits/" .. fileName
	end
	player.interact("ScriptPane", config)
	pane.dismiss()
end

function deleteMode()
	if savedImages["i2"] ~= nil then
		local newSavedImages = {}
		local newSavedImagesLength = 1
		for k, v in pairs(savedImages) do
			if k ~= "i" .. tostring(mode) then
				newSavedImages["i" .. tostring(newSavedImagesLength)] = v
				newSavedImagesLength = newSavedImagesLength + 1
			end
		end
		savedImages = newSavedImages
		mode = math.max(mode - 1,1)
		updatePreview()
	end
end

function updatePreview()

	radioPreview:clear()

	local previewImage = nil

	if savedImages["i1"] == nil then
		radioPreview:drawImage("/assetmissing.png",{0,0},1)
	else
		local pixelList = nil
		-- handle errors in the image
		function foo()
			pixelList = decompressPixelmap(savedImages["i" .. tostring(mode)].pixelmap)
		end
		if pcall(foo) then
			for i, v in ipairs(pixelList) do
				local pixelRect = {v.basePosition[1],v.basePosition[2],v.basePosition[1]+1,v.basePosition[2]+1}
				if savedImages["i" .. tostring(mode)].scaleFactor ~= 1 then
					pixelRect = rect.scale(pixelRect,2.55)
					pixelRect = rect.translate(pixelRect,{-32,1})
				end

				radioPreview:drawRect(pixelRect,"#" .. v.baseColor)
			end
		end
	end
end

function populateList()
	widget.clearListItems(listPath)
	local nearPlayers = world.playerQuery(world.entityPosition(player.id()),200)
	table.sort(nearPlayers, function (left, right)
	    return cutColors(world.entityName(left)) < cutColors(world.entityName(right))
	end)
	for i, player in ipairs(nearPlayers) do
		local currentItem = widget.addListItem(listPath)
		widget.setText(listPath .. "." .. currentItem .. ".name",cutColors(world.entityName(nearPlayers[i])))
		widget.setData(listPath .. "." .. currentItem,nearPlayers[i])
		if nearPlayers[i] == selectedId then
			widget.setListSelected(listPath,currentItem)
		end
	end
end

function sendRadioMessage(entityId)
	local portraitImage = "/assetmissing.png"
	local replaceString = ""
	if savedImages["i1"] == nil then
		portraitImage = "/assetmissing.png"
	else
		replaceString = "?replace"
		local pixelList = nil
		-- handle errors in the image
		function foo()
			pixelList = decompressPixelmap(savedImages["i" .. tostring(mode)].pixelmap)
		end
		if not pcall(foo) then
			pixelList = {}
		end

		local scaleFactor = savedImages["i" .. tostring(mode)].scaleFactor

		local imageOffset = {0,0}
		if scaleFactor == 1 then
			imageOffset = {42, 0} -- image offset for custom images
		end

		for i, v in ipairs(pixelList) do
			for x = 0, scaleFactor - 1 do
				for y = 0, scaleFactor - 1 do
					local r = (v.basePosition[1] * scaleFactor) + x + imageOffset[1]
					local g = 49 - ((v.basePosition[2] * scaleFactor) + y + imageOffset[2])
					local b = 0

					r = r - 42
					g = g - 3

					if r >= 1 and r < 45 and g >= 1 and g < 48 then
						replaceString = replaceString .. ";" .. color.rgb2hex(r,g,b) .. "01=" .. v.baseColor
					end
				end
			end
		end
		portraitImage = baseDirectiveGrid .. replaceString
	end

  	world.sendEntityMessage(entityId,"queueRadioMessage",
	  	{
	    	messageId = "nil",
	        unique = false,
	        important = true,
	        type = "generic",
	        text = radioString,
	        senderName = world.entityName(player.id()),
	        portraitImage = portraitImage,
	        textSpeed = nil,
	        portraitFrames = 1,
	        persistTime = nil,
	        chatterSound = nil
	  	},
  	0)
end

function blank()
end

function cutColors(text)
	return string.gsub(text, "(%^.-%;)", "")
end

function decompressPixelmap(pixelmapString)
	local binaryString = base64.dec(pixelmapString)



	local xWidth = string.byte(binaryString:sub(1,1))


	local numColors = string.byte(binaryString:sub(2,2))

	local colorList = {}
	local offset = 2

	for i = 0, numColors - 1 do
		r = string.byte(binaryString:sub(offset + 1 + i * 4,offset + 1 + i * 4))
		g = string.byte(binaryString:sub(offset + 2 + i * 4,offset + 2 + i * 4))
		b = string.byte(binaryString:sub(offset + 3 + i * 4,offset + 3 + i * 4))
		a = string.byte(binaryString:sub(offset + 4 + i * 4,offset + 4 + i * 4))
		hex = color.rgba2hex(r,g,b,a)
		table.insert(colorList,hex)
	end


	local newPixelmap = {}

	local i = offset + 1 + numColors * 4
	local currentPixel = -1

	while true do
		if i > string.len(binaryString) then
			break
		end
		local count = string.byte(binaryString:sub(i, i))
		local index = 0
		if count < 128 then
			index = count
			count = 1
			i = i + 1
		else
			count = count - 127

			index = string.byte(binaryString:sub(i + 1, i + 1))
			-- TODO: if escape, handle raw rgba color

			i = i + 2
		end
		
		local clr = colorList[index]

		for j = 1, count do
			y = math.floor(currentPixel / xWidth)
			x = currentPixel - (y * xWidth)
			if clr:len() == 6 or string.sub(clr,7,8) ~= "00" then
				table.insert(newPixelmap,{basePosition = {x, y}, baseColor = clr})
			end
			currentPixel = currentPixel + 1
		end
	end


	return newPixelmap
end